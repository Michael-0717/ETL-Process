# Предсказание энергопотребления зданий
## Разберем задачу из соревнования на Kaggle и построим простую модель машинного обучения
Постановка задачи
Всего 3 набора данных: 
(1) building_metadata, 
(2) train и 
(3) weather_train
•	(1) содержит building_id, для которого есть данные (2)
•	(1) содержит site_id, для которого есть данные (3)
Нужно объединить все наборы данных по building_id, site_id и timestamp ETL = получение + очистка + совмещение данных
Данные:
•	http://video.ittensive.com/machine-learning/ashrae/building_metadata.csv.gz
•	http://video.ittensive.com/machine-learning/ashrae/weather_train.csv.gz
•	http://video.ittensive.com/machine-learning/ashrae/train.0.0.csv.gz Соревнование: https://www.kaggle.com/c/ashrae-energy-prediction/
© ITtensive, 2020
___
## Решение:
1) Подключим необходимые библиотеки.
2) Загрузка данных: здания
•	primary_use - назначение (Education – образование)
•	square_feet - площадь, кв.футы
•	year_built - год постройки
•	floor_count - число этажей
3) Загрузка данных: погода
•	air_temperature - температура воздуха, С
•	dew_temperature - точка росы (влажность), С
•	cloud_coverage - облачность, %
•	precip_depth_1_hr - количество осадков, мм/час
•	sea_level_pressure - давление, мбар
•	wind_direction - направление ветра, градусы
•	wind_speed - скорость ветра, м/с
4) Загрузка данных: потребление энергии здания 0
•	meter_reading - значение показателя (TOE, эквивалент тонн нефти)
5) Объединение потребления энергии и информацию о здании. 
Проводим объединение по building_id (индификатор здания) - объединяем в таблицу, с помощью параметра how="left" мы указали, что главным является датафрейм слева, название столбца – «building_id». Используем функцию head() для просмотра первых n строк (по умолчанию 5)
6) Объединение потребления энергии и погоды.
Выставим индексы для объединения - timestamp, site_id. inplace=True - заменяем индекс в исходном DataFrame вместо создания копии DataFrame.
Проведем объединение с помощью функции merge и сбросим индексы.
7) Нахождение пропущенных данных
Посчитаем количество пропусков данных по столбцам, просмотрим значение ячеек столбцов и просуммируем по столбцам. 
8) Заполнение пропущенных данных. Заполним пропущенные сведения по следующей схеме:
•	air_temperature: NaN -> 0                            темпер.воздуха
•	cloud_coverage: NaN -> 0                             облачность
•	dew_temperature: NaN -> 0                            влажность
•	precip_depth_1_hr: NaN -> 0, -1 -> 0                 кол-во осадков
•	sea_level_pressure: NaN -> среднее                   давление
•	wind_direction: NaN -> среднее (роза ветров)         ветер
___
## Интерполяция и экстраполяция
## Постановка задачи
Построить модель энергопотребления здания по часам. Погоду и характеристики здания пока не рассматривать.
Данные: http://video.ittensive.com/machine-learning/ashrae/train.0.0.csv.gz Соревнование: https://www.kaggle.com/c/ashrae-energy-prediction/
© ITtensive, 2020
___
## Решение:
1) Подключим необходимые библиотеки.
2) Загрузка данных: Энергопотребление здания 0.
3) Обогащение данных.
- Добавим серию с часом суток для построения суточной модели потребления.
- С помощью функции to_datetime добавляем новый  столбец "timestamp".
-  переименовываем столбец "timestamp" в "hour", конвертируем формат времени c 2016-01-01 04:00:00 на 0 (час).
4) Среднее потребление по часам.
- разделим и выделим из всего набора данных по значению «hour» с функцией groupby.
- Выведем среднее и медиану потребления энергии по часам.
- отображаем данные на графике. Разница в значениях определяется наличием пустых значений.
5) Фильтруем метрику.
- Удаляем нулевые значения из статистики для устранения значительной разницы значений «Среднее» и «Медиана».
- разделим и выделим из всего набора данных по значению «hour» с функцией groupby.
- удалим нулевые значения.
- отображаем данные на графике.
6) Интерполируем данные по часам (сглаживаем).
- Построим модель внутрисуточного потребление энергии по зданию.
- создаем интерполяционную функцию и нарисуем новый интерполированный граф, метод - кубический.
___
## Оценка модели.
### Постановка задачи
Построить простую модель энергопотребления здания по среднему значению, оценить эффективность модели через метрику
![image](https://user-images.githubusercontent.com/129064114/233066684-2c1492aa-7eab-4358-b15c-8f8bd92c8498.png)
•	n - число наблюдений
•	log - натуральный логарифм
•	p_i - вычисленное значение метрики
•	a_i - заданное значение метрики
Данные: http://video.ittensive.com/machine-learning/ashrae/train.0.0.csv.gz Соревнование: https://www.kaggle.com/c/ashrae-energy-prediction/
© ITtensive, 2020
___
## Решение:
1) Подключим необходимые библиотеки и загрузим данные.
•	Дополнительно сразу отсечем пустые дни и выделим час из значения времени.
•	отбираем значение по столбцу «топливный_экв» со значение > 0.
• дублируем столбец "timestamp" и конвертируем в формат «час».
2) Разделение данных на обучение и проверку.
•	Выделим 20% всех данных на проверку, остальные оставим на обучение
•	используя модуль train_test_split разделяем данные для машинного обучения.
•	переменная test_size фактически указывает пропорцию набора тестов – 20%.
3) Создадим модели.
•	Вычислим среднее и медианное значение потребление энергии по часам.
4) Функция проверки модели.
Для вычисления метрики создадим шесть новых столбцов в тестовом наборе данных: 
1. с логарифмом значения метрики, 
2. с предсказанием по среднему, 
3. с предсказанием по медиане,
4. с квадратом разницы предсказаний,
5. с квадратом разницы логарифма значения,
6. сравнение предсказания с его отсутствием - нулями в значениях.
5) Просуммируем квадраты расхождений, разделим на количество значений и извлем квадратный корень:
•	вычисляем качество медианы.
•	вычисляем качество среднего.
•	вычисляем качество нуля.
___
## Линейная регрессия
Перейдем к более сложному прогнозированию энергопотребления, используем для этого линейную регрессию. Линейную взаимосвязь между исследуемой метрикой и, предположительно, независимыми параметрами – температурой воздуха и влажностью.
## Постановка задачи
Построить модель линейной регрессии энергопотребления здания, используя температуру воздуха (air_temperature) и влажность (dew_temperature).
Рассчитать качество построенной модели по проверочным данным.
Данные
•	http://video.ittensive.com/machine-learning/ashrae/building_metadata.csv.gz
•	http://video.ittensive.com/machine-learning/ashrae/weather_train.csv.gz
•	http://video.ittensive.com/machine-learning/ashrae/train.0.0.csv.gz Соревнование: https://www.kaggle.com/c/ashrae-energy-prediction/
© ITtensive, 2020
___
## Решение:
1) Подключим необходимые библиотеки и загрузим данные.
2) Загрузка данных.
Посмотрим сводную информацию методом info():
- мы узнаем, что в таблице 8784 строки (от 0 до 8783), 
- 4 столбца - количество ненулевых значений (non-null), тип данных: 
- int64 - целые числа (числа размером 8 байт);
- object - абстракция Python для данных,
- float64 – число с плавающей запятой (числа размером 8 байт).
3) Объединение данных и фильтрация.
- объединяем в таблицу, с помощью параметра how="left" мы указали, что главным #является датафрейм слева, название столбца – «building_id».
- проиндексируем в таблице данных energy_0 по столбцам "timestamp", "site_id"
- проиндексируем в таблице данных weather по столбцам "timestamp", "site_id"
- объединяем в таблицу: слева данные energy_0, справа данные weather
- сбросим индекс по данным  energy_0
- отфильтруем только положительные значения 
- преобразовываем формат времени в столбце timestamp
- атрибут dt.hour возвращает массив данных  timestamp к базовым данным (2,4…).
4) Добавление часа в данные.
5) Разделение данных на обучение и проверку:
- Выделим 20% всех данных на проверку, остальные оставим на обучение
- используя модуль train_test_split разделяем данные для машинного обучения.
- переменная test_size фактически указывает пропорцию набора тестов – 20%.
6) Модель линейной регрессии и среднее.
meter_reading = A * air_temperature + B * dew_temperature + C
- чтобы сравнить линейную регрессию с более простой моделью
- дополнительно вычислим среднее по часам.
- исключаем ряд столбцов с данными, будем использовать три серии данных: потребление энергии (топливный эквивалент), температура воздуха и влажность.
- полученные коэффициенты будем использовать для оценки модели.
7) Оценка модели.
Качество линейной регрессии выше качества среднего. 












